tinymce.PluginManager.add('risfieldcreator', function(editor, url) {
    var openDialog = function() {
        return editor.windowManager.open({
            title: 'Variable Creator',
            body: {
                type: 'panel',
                items: [{
                        type: 'selectbox',
                        name: 'marker_type',
                        label: 'Variable Type',
                        items: [
                            { text: "Company Name", value: "Company Name" },
                            { text: "First Name", value: "First Name" },
                            { text: "Date", value: "Date" },
                            { text: "Subscriber ID", value: "Subscriber ID" },
                            { text: "Phone", value: "Phone" },
                            { text: "Email Address", value: "Email Address" },
                            { text: "Job Title", value: "Job Title" },
                            { text: "Last Sent - Date", value: "Last Sent - Date" },
                            { text: "Last Sent - Time", value: "Last Sent - Time" },
                            { text: "Last Sent - HTML", value: "Last Sent - HTML" }
                        ]
                    },
                    {
                        type: 'alertbanner',
                        level: 'warn',
                        icon: 'risfield',
                        text: "After selecting an element, represent it in the 'if exists' box with '$var'. e.g. &quot;Hi $var, nice to meet you.&quot; Will render out to &quot;Hi Order, nice to meet you.&quot; If using the First Name element with the user Order."
                    },
                    {
                        type: 'textarea',
                        name: 'exists',
                        label: "If the variable exists. e.g. Hello $var"
                    },
                    {
                        type: 'textarea',
                        name: 'notexist',
                        label: "Else, the variable does not exist. e.g. Hello World"
                    }
                ]
            },
            buttons: [{
                    type: 'cancel',
                    text: 'Close'
                },
                {
                    type: 'submit',
                    text: 'Save',
                    primary: true
                }
            ],
            onSubmit: function(api) {
                var vars = api.getData();
                var template = `{{${vars.marker_type}|if|${vars.exists}|else|${vars.notexist}}}`;
                editor.insertContent(template);
                api.close();
            }
        });
    };

    // Add a button that opens a window
    editor.ui.registry.addIcon('risfield', '<svg width="24" height="24"><path d="M22 10V6c0-1.11-.9-2-2-2H4c-1.1 0-1.99.89-1.99 2v4c1.1 0 1.99.9 1.99 2s-.89 2-2 2v4c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-4c-1.1 0-2-.9-2-2s.9-2 2-2zm-9 7.5h-2v-2h2v2zm0-4.5h-2v-2h2v2zm0-4.5h-2v-2h2v2z"/></svg>');
    editor.ui.registry.addButton('risfieldcreator', {
        icon: 'risfield',
        onAction: function() {
            openDialog();
        }
    });
    editor.ui.registry.addMenuItem('risfieldcreator', {
        text: 'Variable Creator',
        icon: 'risfield',
        onAction: function() {
            openDialog();
        }
    });

    return {
        getMetadata: function() {
            return {
                name: "Special Variable Creator plugin",
                longname: 'Company Variable Creator',
                author: 'Savin Sabu',
                authorurl: 'https://company.co',
                version: '0.1'
            };
        }
    };
});