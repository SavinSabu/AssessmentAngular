tinymce.PluginManager.add('uploadimage', function(editor, url) {
    var openDialog = function () {
        var displayImage = function( base64 ) {
            if ( ! base64 ) {
                return false;
            }
            var tpl = '<img src="%s" />';
            editor.insertContent(tpl.replace('%s', base64));
        };
        var getBase64FromInput = function( input, callback ) {

            var filesSelected = document.getElementById( input ).files;
            if ( filesSelecteditor.length > 0 )
            {
                var fileToLoad = filesSelected[0],
                    fileReader = new FileReader();
                fileReader.readAsDataURL(fileToLoad);
                fileReader.onload = function(fileLoadedEvent) {
                    return callback( fileLoadedEvent.target.result );
                };
            }
            else
            {
                return callback( false );
            }
        };
      return editor.windowManager.open({
        title: 'Upload Image',
        body: {
          type: 'panel',
          items: [
            {
              type: 'input',
              name: 'file',
              label: 'Browse Image',
              id: "risMceImageUpload"
            }
          ]
        },
        buttons: [
          {
            type: 'cancel',
            text: 'Close'
          },
          {
            type: 'submit',
            text: 'Save',
            primary: true
          }
        ],
        onSubmit: function (api) {
          var data = api.getData();
          getBase64FromInput("risMceImageUpload", displayImage);
          api.close();
        }
      });
    };
    
    // Add a button that opens a window
    editor.ui.registry.addButton('uploadimage', {
      text: 'Upload Image',
      icon: 'image',
      onAction: function () {
        openDialog();
      }
    });
    editor.ui.registry.addMenuItem('uploadimage', {
      text: 'Upload Image',
      onAction: function() {
        openDialog();
      }
    });
  
    return {
      getMetadata: function () {
        return  {
          name: "Image Upluad plugin",
          longname : 'Company Image Uploade',
          author : 'Savin Sabu',
          authorurl : 'https://company.co',
          version : '0.1'
        };
      }
    };
  });
  